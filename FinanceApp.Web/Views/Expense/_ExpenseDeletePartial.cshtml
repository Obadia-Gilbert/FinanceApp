@model FinanceApp.Web.Models.ExpenseDeleteViewModel

<div class="p-3">
    <h5 class="mb-3">Confirm Delete</h5>
    <p>Are you sure you want to delete the expense <strong>"@Model.Description"</strong> dated <strong>@Model.ExpenseDate.ToString("yyyy-MM-dd")</strong> with amount <strong>@Model.Amount</strong>?</p>

    <form asp-action="Delete" method="post" class="d-flex justify-content-end gap-2">
        <input type="hidden" name="id" value="@Model.Id" />
        <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">Cancel</button>
        <button type="submit" class="btn btn-danger">Delete</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('#expenseOffcanvasContent form') || document.querySelector('#expenseOffcanvasContent form');
        if (!form) return;

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(form);
            const action = form.getAttribute('action') || window.location.href;
            const res = await fetch(action, {
                method: 'POST',
                headers: { 'X-Requested-With': 'XMLHttpRequest' },
                body: formData
            });

            const contentType = res.headers.get('content-type') || '';
            if (contentType.indexOf('application/json') !== -1) {
                const json = await res.json();
                if (json.success) {
                    const offcanvasEl = document.getElementById('expenseOffcanvas');
                    const bs = bootstrap.Offcanvas.getInstance(offcanvasEl) || new bootstrap.Offcanvas(offcanvasEl);
                    bs.hide();
                    window.location.reload();
                }
                return;
            }

            const html = await res.text();
            const content = document.getElementById('expenseOffcanvasContent');
            content.innerHTML = html;
        });
    });
</script>
