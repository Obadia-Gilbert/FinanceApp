@model FinanceApp.Web.Models.CategoryDeleteViewModel

<div class="p-3">
    <h5 class="mb-3">Delete Category</h5>
    <p>Are you sure you want to permanently delete the category <strong>@Model.Name</strong>? This action cannot be undone.</p>

    <form asp-action="Delete" method="post" class="d-flex justify-content-end gap-2">
        <input type="hidden" name="id" value="@Model.Id" />
        <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">Cancel</button>
        <button type="submit" class="btn btn-danger">Delete</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('#categoryOffcanvasContent form') || document.querySelector('#categoryOffcanvasContent form');
        if (!form) return;

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(form);
            const action = form.getAttribute('action') || window.location.href;
            const res = await fetch(action, {
                method: 'POST',
                headers: { 'X-Requested-With': 'XMLHttpRequest' },
                body: formData
            });

            const contentType = res.headers.get('content-type') || '';
            if (contentType.indexOf('application/json') !== -1) {
                const json = await res.json();
                if (json.success) {
                    const offcanvasEl = document.getElementById('categoryOffcanvas');
                    const bs = bootstrap.Offcanvas.getInstance(offcanvasEl) || new bootstrap.Offcanvas(offcanvasEl);
                    bs.hide();
                    window.location.reload();
                }
                return;
            }

            const html = await res.text();
            const content = document.getElementById('categoryOffcanvasContent');
            content.innerHTML = html;
        });
    });
</script>
